# 博客文章页面优化总结

## 已完成的改进

### 1. 侧边目录导航（Table of Contents）

**桌面端：**
- 右侧固定侧边栏显示文章目录
- 自动提取 H2、H3、H4 标题
- 滚动时自动高亮当前阅读的章节
- 点击目录项平滑滚动到对应章节
- 支持多级标题缩进显示

**移动端：**
- 右下角浮动按钮打开目录
- 侧滑抽屉式目录面板
- 点击目录项后自动关闭面板
- 背景遮罩支持点击关闭

### 2. 文章样式优化

**排版改进：**
- 标题层级清晰，H2 带下划线分隔
- 段落间距合理，行高舒适
- 列表样式优化，使用蓝色标记
- 引用块带左侧蓝色边框和背景色
- 代码块圆角边框，背景色区分

**特殊元素：**
- 链接蓝色高亮，hover 效果
- 粗体文字加重显示
- 表格边框和背景色
- 图片圆角和阴影
- 水平分隔线

**响应式：**
- 移动端标题字号自动缩小
- 代码块字号适配
- 目录按钮仅在移动端显示

### 3. HTML 实体编码处理

**自动解码：**
- `&ldquo;` → "
- `&rdquo;` → "
- `&hellip;` → …
- `&mdash;` → —

浏览器会自动将 HTML 实体转换为对应字符，无需手动处理。

### 4. 交互体验

**滚动行为：**
- 点击目录平滑滚动
- 自动高亮当前章节
- 滚动偏移考虑导航栏高度

**动画效果：**
- 目录激活状态带动画
- 移动端抽屉弹出动画
- 按钮 hover 效果

## 文件变更

### 新增文件：
1. `components/Blog/ArticleContent.tsx` - 文章内容组件（带目录）

### 修改文件：
1. `app/[locale]/blog/[slug]/page.tsx` - 使用新的 ArticleContent 组件
2. `app/globals.css` - 添加文章样式和目录样式

## 使用方法

文章内容会自动：
1. 提取所有 H2、H3、H4 标题生成目录
2. 为每个标题添加唯一 ID
3. 监听滚动位置高亮当前章节
4. 支持点击跳转

## 样式特点

### 目录样式：
- 桌面端：右侧固定，毛玻璃效果
- 移动端：浮动按钮 + 侧滑抽屉
- 激活状态：蓝色高亮 + 左侧边框
- 层级缩进：根据标题级别自动缩进

### 文章样式：
- 标题：大号粗体，H2 带下划线
- 段落：行高 1.75，间距 1.5rem
- 列表：蓝色标记，间距适中
- 引用：左侧蓝色边框，浅蓝背景
- 代码：圆角边框，浅色背景
- 链接：蓝色下划线，hover 变深

## 技术实现

### 目录生成：
```typescript
// 自动提取标题
const headingElements = contentRef.current.querySelectorAll('h2, h3, h4');

// 为每个标题添加 ID
heading.id = `heading-${index}`;

// 监听滚动位置
const observer = new IntersectionObserver(...);
```

### 平滑滚动：
```typescript
const scrollToHeading = (id: string) => {
  const element = document.getElementById(id);
  const offset = 100; // 导航栏高度
  window.scrollTo({
    top: offsetPosition,
    behavior: 'smooth',
  });
};
```

### 响应式设计：
```css
/* 桌面端显示侧边栏 */
.hidden.lg:block

/* 移动端显示浮动按钮 */
.lg:hidden.fixed.bottom-8.right-8
```

## 浏览器兼容性

- Chrome/Edge: ✅ 完全支持
- Firefox: ✅ 完全支持
- Safari: ✅ 完全支持
- 移动浏览器: ✅ 完全支持

## 性能优化

- 使用 IntersectionObserver 监听滚动（性能优于 scroll 事件）
- 目录仅在有标题时显示
- 移动端抽屉使用 AnimatePresence 优化动画
- CSS 使用 GPU 加速的 transform

## 下一步建议

1. **添加进度条**：显示文章阅读进度
2. **分享功能**：完善社交媒体分享
3. **相关文章**：文章底部推荐相关内容
4. **评论系统**：集成评论功能
5. **打印样式**：优化打印输出
6. **深色模式**：优化深色模式下的对比度

## 测试清单

- [x] 桌面端目录显示正常
- [x] 移动端浮动按钮显示
- [x] 点击目录项平滑滚动
- [x] 滚动时自动高亮
- [x] HTML 实体正确显示
- [x] 响应式布局正常
- [x] 深色模式适配
- [x] 构建成功无错误
