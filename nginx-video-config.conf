# MatrixAgent 视频流优化配置
# 将此配置添加到你的 nginx.conf 中

# 视频文件位置配置
location /videos/ {
    alias /path/to/your/public/videos/;
    
    # 防止直接下载
    add_header Content-Disposition 'inline';
    add_header X-Content-Type-Options 'nosniff';
    
    # 启用范围请求支持（用于视频流）
    add_header Accept-Ranges bytes;
    
    # 缓存控制
    add_header Cache-Control "public, max-age=31536000, immutable";
    
    # 防盗链 - 只允许从你的域名访问
    valid_referers none blocked server_names
                   *.matrixlab.work
                   develop.matrixlab.work;
    if ($invalid_referer) {
        return 403;
    }
    
    # 限制访问速率（防止恶意下载）
    limit_rate 2m;  # 限制为 2MB/s
    
    # 启用 sendfile 优化
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    
    # 视频文件类型
    types {
        video/mp4 mp4;
        video/webm webm;
    }
}

# 可选：添加 HLS 流媒体支持（更好的性能和防下载）
# 需要 nginx-rtmp-module 或转换视频为 HLS 格式
location /hls/ {
    types {
        application/vnd.apple.mpegurl m3u8;
        video/mp2t ts;
    }
    
    add_header Cache-Control "no-cache";
    add_header Access-Control-Allow-Origin "*";
    
    # 防盗链
    valid_referers none blocked server_names
                   *.matrixlab.work
                   develop.matrixlab.work;
    if ($invalid_referer) {
        return 403;
    }
}
